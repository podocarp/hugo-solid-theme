{{ define "main" }}
    {{ $visiblePages := where .Site.RegularPages ".Params.hidden" "!=" true }}
    {{ if .Params.categories }}
        {{ .Scratch.Set "pages" (where $visiblePages ".Params.categories" "intersect" .Params.categories) }}

        {{ range first 1 (where (.Scratch.Get "pages") ".Params.type" "eq" "gallery") }}
            {{ $.Scratch.Set "associatedGallery" (intersect .Params.categories .Parent.Params.categories) }}
        {{ end }}
    {{ else }}
        {{ .Scratch.Set "pages" (where $visiblePages ".Type" .Type) }}
    {{ end }}

    {{ if .Params.type }}
        {{ $file := (add "list_" .Params.type) }}
        {{ partial $file . }}
    {{ end }}
{{ end }}
